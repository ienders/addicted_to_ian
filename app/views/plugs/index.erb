<% plugs = [ 'liz', 'mally', 'kates', 'kimara', 'lucky', 'indagare', 'amazon', 'ibm', 'kanetix', 'weatheroffice', 'jonsonia' ] %>

<script type = "text/javascript">

  var num_plugs = <%= plugs.size %>
  
  $(function() {
    $('.thumb_holder').click(function(e) {
      var i = parseInt($(this).attr('rel'));

      
      var minX = parseInt($('.pictures').offset().left);
      var maxX = parseInt($('.pictures').offset().left) + parseInt($('.pictures').css('width'));
      var minY = parseInt($('.pictures').offset().top);
      
      $('.thumb_holder').each(function() {
        var per_row = 4;
        var i = parseInt($(this).attr('rel'));
        
        var col = i % per_row;
        var row = (i - (i % per_row)) / per_row;
        
        var left = parseInt($(this).offset().left) + 1;
        var top = parseInt($(this).offset().top) + 1;
        
        var height = parseInt($(this).css('height')) - 1;
        var width = parseInt($(this).css('width')) - 1;
        
        $(this).css('position', 'absolute').css('top', (top + height * row) + 'px').css('left', left + (col * width) + 'px');
      });

      var arr = new Array();
      for (var i = 0; i < num_plugs; i++) {
        arr.push(i);
      }
      arr.sort(function() { return (Math.round(Math.random()) - 0.5) })
      var index = 0;
      
      (function randomHide(e) {
        var j = parseInt(e.attr('rel'));
        e.hide('fast', function() {
          index++;
          if (index < num_plugs) {
            randomHide($('#plug_' + arr[index]));
          }
        });
      })($('#plug_' + arr[index]));
      

      // (function hidePlugBackwards(e) {
      //   if (e.css('display') != 'none') {
      //     var j = parseInt(e.attr('rel'));
      //     e.hide('slow', function() {
      //       if (j > 0) {
      //         hidePlugBackwards($('#plug_' + (j - 1)));
      //       }
      //     });
      //   }
      // })($('#plug_' + (num_plugs - 1)));
      // 
      // (function hidePlugForwards(e) {
      //   if (e.css('display') != 'none') {
      //     var k = parseInt(e.attr('rel'));
      //     e.hide('slow', function() {
      //       if (k < num_plugs - 2) {
      //         hidePlugForwards($('#plug_' + (k + 1)));
      //       }
      //     });
      //   }
      // })($('#plug_0'));

      e.preventDefault();
    })
  });
  
  function hideNext() {
    
  }
  
</script>

<div id="thumb_wrapper">
  <% plugs.each_with_index do |plug, i| %>
    <div class="thumb_holder" id = "plug_<%= i %>" rel = "<%= i %>">
      <%= link_to(image_tag("thumb_#{plug}.jpg"), '#') %>
    </div>
  <% end %>
</div>
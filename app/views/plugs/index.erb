<% plugs = [ 'liz', 'mally', 'kates', 'kimara', 'lucky', 'indagare', 'amazon', 'ibm', 'kanetix', 'weatheroffice', 'jonsonia' ] %>

<script type = "text/javascript">

  var num_plugs = <%= plugs.size %>
  
  $(function() {
    $('.thumb_holder').click(function(e) {
      var holder = $(this);
      var i = parseInt($(this).attr('rel'));
      
      $('.thumb_holder').each(function() {
        var per_row = 4;
        var i = parseInt($(this).attr('rel'));
        
        var col = i % per_row;
        var row = (i - (i % per_row)) / per_row;
        
        var left = 0; //parseInt($(this).offset().left) + 2;
        var top = 0; //parseInt($(this).offset().top) + 1;
        
        var height = parseInt($(this).css('height')) - 1;
        var width = parseInt($(this).css('width')) - 1;
        
        $(this).css('position', 'absolute').css('top', (top + height * row) + 'px').css('left', left + (col * width) + 'px');
      });

      var arr = new Array();
      for (var k = 0; k < num_plugs; k++) {
        if (i != k) {
          arr.push(k);  
        }
      }
      arr.sort(function() { return (Math.round(Math.random()) - 0.5) })
      var index = 0;

      (function randomHide(e) {
        var j = parseInt(e.attr('rel'));
        e.fadeOut(100, function() {
          index++;
          if (index < arr.length) {
            randomHide($('#plug_' + arr[index]));
          } else {
            doneHiding(holder);
          }
        });
      })($('#plug_' + arr[index]));

      e.preventDefault();
    })
  });
  
  function doneHiding(obj) {
    obj.find('img').attr('src', '/images/thumb_large_ibm.jpg');
    obj.animate({ left: 17, top: 27}, 2000, function() {
      obj.find('img').animate({ height: 300, width: 500 }, 'medium', function() {
        $('.plug').fadeIn('slow', function() {
          sifr_plugs();
          $('.plug_text').fadeIn('slow', function() {
            $('.plug_link_holder').fadeIn('slow', function() {
              $('.close').fadeIn('slow');
            });
          });
        });
      });
    });
  }
</script>

<div class = "plugs_content">
   <div class = "plug_thumb_wrapper">
    <% plugs.each_with_index do |plug, i| %>
      <div class="thumb_holder" id = "plug_<%= i %>" rel = "<%= i %>">
        <%= link_to(image_tag("thumb_#{plug}.jpg"), '#') %>
      </div>
    <% end %>
  </div>
  
  <div class = "plug" style = "display: none">
    <%= image_tag("button_close.gif", :class => 'close', :style => 'display: none') %>
    <%= image_tag("thumb_large_ibm.jpg", :class => 'plug_hero') %>
    <div class = "plug_link_holder" style = "display: none">
      [ <%= link_to('www.ibm.de', 'www.ibm.de') %> ]
    </div>
    <div class = "plug_description_holder">
      <h3>IBM Deutchland</h3>
      <div class = "plug_text" style = "display: none">
        <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam adipiscing nisl vel mauris. Vivamus fringilla lectus ac purus. Nunc ut orci ut lacus vulputate egestas. Vivamus accumsan, tortor eu porta accumsan, felis mi luctus urna, non faucibus mauris nunc vitae leo. Quisque vulputate tempus leo. In elementum. Vivamus est. In metus diam, vulputate vulputate, faucibus a, lacinia quis, lorem. Duis aliquet, ipsum vel pulvinar imperdiet, orci orci fermentum ipsum, sit amet scelerisque turpis enim in orci. Curabitur arcu sapien, interdum auctor, ultricies sit amet, placerat nec, velit.
  </p>
  <p>
        In hac habitasse platea dictumst. Proin aliquet. Mauris lacinia purus non ante. Mauris ultrices tortor nec metus. Integer mattis imperdiet enim. Proin odio nisi, gravida at, lobortis id, ornare non, felis. Vestibulum egestas.</p>
        <h4>Technologies</h4>
        <ul>
          <li><A href = "#">php</a></li>
          <li>mysql</li>
          <li><a href = "#">javascript</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>